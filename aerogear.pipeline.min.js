/*! AeroGear JavaScript Library - v1.3.2 - 2014-01-28
* https://github.com/aerogear/aerogear-js
* JBoss, Home of Professional Open Source
* Copyright Red Hat, Inc., and individual contributors
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
* http://www.apache.org/licenses/LICENSE-2.0
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
(function(e,t){this.AeroGear={},AeroGear.Core=function(){if(this instanceof AeroGear.Core)throw"Invalid instantiation of base class AeroGear.Core";this.add=function(e){var t,r,i=this[this.collectionName]||{};if(this[this.collectionName]=i,!e)return this;if("string"==typeof e)i[e]=AeroGear[this.lib].adapters[this.type](e,this.config);else if(AeroGear.isArray(e))for(t=0;e.length>t;t++)r=e[t],"string"==typeof r?i[r]=AeroGear[this.lib].adapters[this.type](r,this.config):r.name&&(r.settings=AeroGear.extend(r.settings||{},this.config),r.settings.recordId=r.settings.recordId||r.recordId,i[r.name]=AeroGear[this.lib].adapters[r.type||this.type](r.name,r.settings));else{if(!e.name)return this;e.settings=AeroGear.extend(e.settings||{},this.config),e.settings.recordId=e.settings.recordId||e.recordId,i[e.name]=AeroGear[this.lib].adapters[e.type||this.type](e.name,e.settings)}return this[this.collectionName]=i,this},this.remove=function(e){var t,r,i=this[this.collectionName]||{};if("string"==typeof e)delete i[e];else if(AeroGear.isArray(e))for(t=0;e.length>t;t++)r=e[t],"string"==typeof r?delete i[r]:delete i[r.name];else e&&delete i[e.name];return this[this.collectionName]=i,this}},AeroGear.isArray=function(e){return"[object Array]"==={}.toString.call(e)},AeroGear.extend=function(e,t){var r;for(r in t)e[r]=t[r];return e},AeroGear.Pipeline=function(e){return this instanceof AeroGear.Pipeline?(AeroGear.Core.call(this),this.config=e||{},this.lib="Pipeline",this.type=e?e.type||"Rest":"Rest",this.collectionName="pipes",this.add(e),t):new AeroGear.Pipeline(e)},AeroGear.Pipeline.prototype=AeroGear.Core,AeroGear.Pipeline.constructor=AeroGear.Pipeline,AeroGear.Pipeline.adapters={},AeroGear.Pipeline.adapters.Rest=function(e,r){if(!(this instanceof AeroGear.Pipeline.adapters.Rest))return new AeroGear.Pipeline.adapters.Rest(e,r);r=r||{};var i=r.endpoint||e,n={url:r.baseURL?r.baseURL+i:i,contentType:r.contentType||"application/json",dataType:r.dataType||"json",xhrFields:r.xhrFields},s=r.recordId||"id",a=r.authenticator||null,o=r.pageConfig,u=r.timeout?1e3*r.timeout:6e4;this.getAjaxSettings=function(){return n},this.getAuthenticator=function(){return a},this.getRecordId=function(){return s},this.getTimeout=function(){return u},this.getPageConfig=function(){return o},this.updatePageConfig=function(e,t){t?(o={},o.metadataLocation=e.metadataLocation?e.metadataLocation:"webLinking",o.previousIdentifier=e.previousIdentifier?e.previousIdentifier:"previous",o.nextIdentifier=e.nextIdentifier?e.nextIdentifier:"next",o.parameterProvider=e.parameterProvider?e.parameterProvider:null):jQuery.extend(o,e)},o&&this.updatePageConfig(o,!0),this.webLinkingPageParser=function(e){var r,i,n,s,a,u={};i=e.getResponseHeader("Link").split(",");for(var p in i){r=i[p].trim().split(";");for(var d in r)n=r[d].trim(),0===n.indexOf("<")&&n.lastIndexOf(">")===r[d].length-1?s=n.substr(1,n.length-2).split("?")[1]:0===n.indexOf("rel=")&&(n.indexOf(o.previousIdentifier)>=0?a=o.previousIdentifier:n.indexOf(o.nextIdentifier)>=0&&(a=o.nextIdentifier));a&&(u[a]=s,a=t)}return u},this.headerPageParser=function(e){var t=e.getResponseHeader(o.previousIdentifier),r=e.getResponseHeader(o.nextIdentifier),i={},n={};return o.parameterProvider?(i=o.parameterProvider(e),n[o.previousIdentifier]=i[o.previousIdentifier],n[o.nextIdentifier]=i[o.nextIdentifier]):(n[o.previousIdentifier]=t?t.split("?")[1]:null,n[o.nextIdentifier]=r?r.split("?")[1]:null),n},this.bodyPageParser=function(e){var t={},r={};return o.parameterProvider?(r=o.parameterProvider(e),t[o.previousIdentifier]=r[o.previousIdentifier],t[o.nextIdentifier]=r[o.nextIdentifier]):(t[o.previousIdentifier]=e[o.previousIdentifier],t[o.nextIdentifier]=e[o.nextIdentifier]),t},this.formatJSONError=function(e){if("json"===this.getAjaxSettings().dataType)try{e.responseJSON=JSON.parse(e.responseText)}catch(t){}return e}},AeroGear.Pipeline.adapters.Rest.prototype.read=function(e){var r,i,n,s,a=this,o=this.getRecordId(),u=this.getAjaxSettings(),p=this.getPageConfig();if(e=e?e:{},e.query=e.query?e.query:{},r=e[o]?u.url+"/"+e[o]:u.url,p&&e.paging!==!1){e.paging||(e.paging={offset:e.offsetValue||0,limit:e.limitValue||10}),e.query=e.query||{};for(var d in e.paging)e.query[d]=e.paging[d]}return i=function(r,i,n){var s;p&&e.paging!==!1&&(s=a[p.metadataLocation+"PageParser"]("body"===p.metadataLocation?r:n),["previous","next"].forEach(function(i){r[i]=function(e,r,i){return function(n){return i.paging=!0,i.offsetValue=i.limitValue=t,i.query=r,i.success=n&&n.success?n.success:i.success,i.error=n&&n.error?n.error:i.error,e.read(i)}}(a,s[p[i+"Identifier"]],e)})),e.success&&e.success.apply(this,arguments)},n=function(t){t=a.formatJSONError(t),e.error&&e.error.apply(this,arguments)},s={type:"GET",data:e.query,success:i,error:n,url:r,statusCode:e.statusCode,complete:e.complete,headers:e.headers,timeout:this.getTimeout()},e.jsonp&&(s.dataType="jsonp",s.jsonp=e.jsonp.callback?e.jsonp.callback:"callback",e.jsonp.customCallback&&(s.jsonpCallback=e.jsonp.customCallback)),jQuery.ajax(jQuery.extend({},this.getAjaxSettings(),s))},AeroGear.Pipeline.adapters.Rest.prototype.save=function(t,r){var i,n,s,a,o,u,p,d=this,c=this.getRecordId(),f=this.getAjaxSettings();if(t=t||{},r=r||{},i=t[c]?"PUT":"POST",n=t[c]?f.url+"/"+t[c]:f.url,s=function(){r.success&&r.success.apply(this,arguments)},a=function(e){e=d.formatJSONError(e),r.error&&r.error.apply(this,arguments)},o=jQuery.extend({},f,{data:t,type:i,url:n,success:s,error:a,statusCode:r.statusCode,complete:r.complete,headers:r.headers,timeout:this.getTimeout()}),"FormData"in e){u=new FormData;for(p in t)u.append(p,t[p]),(t[p]instanceof File||t[p]instanceof Blob)&&(o.contentType=!1,o.processData=!1);o.contentType===!1&&(o.data=u),o.xhr=function(){var e=jQuery.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(){r.progress&&r.progress.apply(this,arguments)},!1),e}}return"application/json"===o.contentType&&o.data&&"string"!=typeof o.data&&(o.data=JSON.stringify(o.data)),jQuery.ajax(jQuery.extend({},this.getAjaxSettings(),o))},AeroGear.Pipeline.adapters.Rest.prototype.remove=function(e,t){var r,i,n,s,a,o=this,u=this.getRecordId(),p=this.getAjaxSettings(),d="";return"string"==typeof e||"number"==typeof e?r=e:e&&e[u]?r=e[u]:e&&!t&&(t=e),t=t||{},d=r?"/"+r:"",i=p.url+d,n=function(){t.success&&t.success.apply(this,arguments)},s=function(e){e=o.formatJSONError(e),t.error&&t.error.apply(this,arguments)},a={type:"DELETE",url:i,success:n,error:s,statusCode:t.statusCode,complete:t.complete,headers:t.headers,timeout:this.getTimeout()},jQuery.ajax(jQuery.extend({},p,a))}})(this);
